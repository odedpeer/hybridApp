<!DOCTYPE html>
<html>
<head>
<meta name="format-detection" content="telephone=no">
<meta name="msapplication-tap-highlight" content="no">
<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
<title>TraffiTruck</title>
<script type="text/javascript" src="cordova.js"></script>
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript">
document.addEventListener("deviceready",onDeviceReady,false);
function onDeviceReady(){
	console.log("Device Ready")
	var push = PushNotification.init( { 
		"android": {"senderID": "316184379540"},
		"ios": {"alert": "true", "badge": "true", "sound": "true"}, "windows": {} 
	} );

	push.on('registration', function(data) {
		$("#gcm_id").html(data.registrationId);
		
//		var f = document.getElementById('TheForm');
//		f.regid.value = data.registrationId;
//	    window.open('', 'TheWindow');
//		f.submit();

		var ref = cordova.InAppBrowser.open('http://parsa.co.il/menu', '_blank', 'location=no,hardwareback=no')
		ref.addEventListener('exit', function(event) { navigator.app.exitApp(); });
		// TODO open the parsa website if this is not an on.notification() event. Wait for a notification?
	});

	push.on('notification', function(data) {
		console.log("ODED notification");
		$("#notification_id").html("<a href='" + data.additionalData.url + "'>" + data.additionalData.url + "</a>");
		// data.title,
		// data.count,
		// data.sound,
		// data.image,
		// data.additionalData
	});

	push.on('error', function(e) {
		console.log(e.message);
	});
}
</script>
</head>
<body>
	<h1>Push Notification index page</h1>
	Your GCM ID : <br/>
	<p id="gcm_id"></p>

	<form id="TheForm" method="post" action="http://parsa.co.il/postlogin" target="TheWindow">
		<input type="hidden" name="regid" value="" />
	</form>
</body>
</html>